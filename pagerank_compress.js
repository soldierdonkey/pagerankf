const decay=.85;is_mouse_down=!1,currently_connecting=-1,document.addEventListener("mousedown",t=>{is_mouse_down=!0}),document.addEventListener("mouseup",t=>{is_mouse_down=!1,currently_connecting=-1,document.getElementById("main").style.cursor="default"});class Website{constructor(t,e,i){this.parent_index=i,this.parent=t,this.link_list=e,this._x=0,this._y=0,this.x=t=>(this._x=t,this.element.style.left=this._x+"px",this),this.y=t=>(this._y=t,this.element.style.top=this._y+"px",this),this.get_x=()=>this._x,this.get_y=()=>this._y,this.element=document.createElement("div"),this.element.classList.add("website"),this.name_element=document.createElement("div"),this.name_element.classList.add("name"),this.name_element.contentEditable=!0,this.element.appendChild(this.name_element),this._rank=NaN,this.rank_element=document.createElement("div"),this.rank_element.classList.add("rank"),this.element.appendChild(this.rank_element),this.connect_button=document.createElement("div"),this.connect_button.classList.add("connect_button"),this.connect_button.addEventListener("mousedown",()=>{currently_connecting=this.parent_index,document.getElementById("main").style.cursor="alias"}),this.element.appendChild(this.connect_button),this.delete_button=document.createElement("div"),this.delete_button.classList.add("delete_button"),this.delete_button.addEventListener("mousedown",()=>{this.remove()}),this.element.appendChild(this.delete_button),this.rank=t=>(this._rank=t,this.rank_element.innerText=this._rank.toFixed(3),this),this.name=t=>(this.name_element.innerText=t,this),this.is_mouse_down=!1,this.element.addEventListener("mousedown",t=>{this.element.style.zIndex=10,this.is_mouse_down=!0}),this.element.addEventListener("mouseup",t=>{this.element.style.zIndex=3,this.is_mouse_down=!1,currently_connecting>-1&&(this.parent.website_list[currently_connecting].link_list.indexOf(this.parent_index)>-1?this.parent.website_list[currently_connecting].link_list.splice(this.parent.website_list[currently_connecting].link_list.indexOf(this.parent_index),1):this.parent.website_list[currently_connecting].link_list.push(this.parent_index),this.parent.calculate(),this.parent.clear_lines(),this.parent.draw_all_connections())}),this.element.addEventListener("mousemove",t=>{is_mouse_down&&-1==currently_connecting&&(this.x(t.clientX-50),this.y(t.clientY-50),this.parent.clear_lines(),this.parent.draw_all_connections())}),this.parent.element.appendChild(this.element),this.remove=()=>{for(let t=0;t<this.parent.website_list.length;t++)this.parent.website_list[t].link_list.indexOf(this.parent_index)>-1&&this.parent.website_list[t].link_list.splice(this.parent.website_list[t].link_list.indexOf(this.parent_index),1);this.link_list=[],this.element.remove(),this.parent.calculate(),this.parent.clear_lines(),this.parent.draw_all_connections()}}}class Web{constructor(){this.canvas=document.createElement("canvas"),this.canvas.classList.add("canvas"),this.canvas.style.zIndex=-1,this.context=this.canvas.getContext("2d"),this.canvas.width=Math.max(document.documentElement.clientWidth,document.body.scrollWidth,document.documentElement.scrollWidth,document.body.offsetWidth,document.documentElement.offsetWidth),this.canvas.height=Math.max(document.documentElement.clientHeight,document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight),document.getElementById("main").appendChild(this.canvas),this.element=document.createElement("div"),this.control_panel=document.createElement("div"),this.control_panel.classList.add("control_panel"),this.control_tab=document.createElement("div"),this.control_tab.classList.add("control_tab"),this.control_panel.appendChild(this.control_tab),this.description=document.createElement("div"),this.description.appendChild(document.createTextNode("All circles are draggable\nRed dots remove Websites\nGreen dots connect Sites")),this.control_panel.appendChild(this.description),this.description.classList.add("description"),this.iterations_slider=document.createElement("input"),this.iterations_slider.type="range",this.iterations_slider.classList.add("slider"),this.iterations_slider.min=1,this.iterations_slider.step=1,this.iterations_slider.max=50,this.iterations_slider.value=35,this.iterations=35,this.control_panel.appendChild(this.iterations_slider),this.iterations_slider_label=document.createElement("div"),this.iterations_slider_label.appendChild(document.createTextNode("Iterations: ")),this.iterations_slider_label.classList.add("slider_label"),this.iterations_slider_label_display=document.createElement("span"),this.iterations_slider_label_display.innerText=35,this.iterations_slider_label.appendChild(this.iterations_slider_label_display),this.iterations_slider.addEventListener("input",()=>{this.iterations=this.iterations_slider.value,this.iterations_slider_label_display.innerText=this.iterations_slider.value,this.calculate()}),this.control_panel.appendChild(this.iterations_slider_label),this.add_new_website_button=document.createElement("div"),this.add_new_website_button.classList.add("add_new_website_button"),this.add_new_website_button.addEventListener("mouseup",()=>{this.add_new_website([],"New Website",this.get_control_x(),this.get_control_y())}),this.add_new_website_button_text=document.createElement("div"),this.add_new_website_button_text.appendChild(document.createTextNode("New Website")),this.add_new_website_button_text.classList.add("add_new_website_button_text"),this.add_new_website_button.appendChild(this.add_new_website_button_text),this.control_panel.appendChild(this.add_new_website_button),document.getElementById("main").appendChild(this.control_panel),this._control_x=0,this._control_y=0,this.control_x=t=>(this._control_x=t,this.control_panel.style.left=this._control_x+"px",this),this.control_y=t=>(this._control_y=t,this.control_panel.style.top=this._control_y+"px",this),this.get_control_x=()=>this._control_x,this.get_control_y=()=>this._control_y,this.control_tab.addEventListener("mousemove",t=>{is_mouse_down&&(this.control_x(t.clientX-50),this.control_y(t.clientY-50))}),this.control_tab.addEventListener("mousedown",t=>{this.control_panel.style.zIndex=10}),this.control_tab.addEventListener("mouseup",t=>{this.control_panel.style.zIndex=2}),document.getElementById("main").appendChild(this.element),this.website_list=[],this.rankings=[];for(let t=0;t<this.website_list.length;t++)this.rankings.push(.25);this.calculate_rank=t=>{let e=0;for(let i=0;i<this.website_list.length;i++)i!=t&&this.website_list[i].link_list.includes(t)&&(e+=this.rankings[i]/this.website_list[i].link_list.length);return .15000000000000002+.85*e}}generate_line_coordinates(t,e){let i=Math.sign(this.website_list[e].get_x()-this.website_list[t].get_x()),s=Math.sign(this.website_list[e].get_y()-this.website_list[t].get_y()),n=(this.website_list[e].get_x()-this.website_list[t].get_x())/(this.website_list[e].get_y()-this.website_list[t].get_y()),l=(this.website_list[e].get_y()-this.website_list[t].get_y())/(this.website_list[e].get_x()-this.website_list[t].get_x());return[this.website_list[e].get_x()-i*Math.sqrt(2500/(1+l**2))+50,this.website_list[e].get_y()-s*Math.sqrt(2500/(1+n**2))+50,this.website_list[t].get_x()+50,this.website_list[t].get_y()+50,this.website_list[e].get_x()-i*Math.sqrt(3600/(1+l**2))-s*Math.sqrt(100/(1+n**2))+50,this.website_list[e].get_y()-s*Math.sqrt(3600/(1+n**2))+i*Math.sqrt(100/(1+l**2))+50,this.website_list[e].get_x()-i*Math.sqrt(3600/(1+l**2))+s*Math.sqrt(100/(1+n**2))+50,this.website_list[e].get_y()-s*Math.sqrt(3600/(1+n**2))-i*Math.sqrt(100/(1+l**2))+50,]}draw_all_connections(){for(let t=0;t<this.website_list.length;t++)for(let e=0;e<this.website_list[t].link_list.length;e++)this.draw_line(...this.generate_line_coordinates(t,this.website_list[t].link_list[e]));return this}clear_lines(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}draw_line(t,e,i,s,n,l,h,a){this.context.beginPath(),this.context.moveTo(t,e),this.context.lineTo(i,s),this.context.lineWidth=2,this.context.stroke(),this.context.beginPath(),this.context.lineTo(t,e),this.context.lineTo(n,l),this.context.lineTo(h,a),this.context.lineTo(t,e),this.context.lineWidth=2,this.context.stroke()}add_new_website(t,e="",i=0,s=0){return this.website_list.push(new Website(this,t,this.website_list.length).name(e).x(i).y(s)),this.calculate(),this}calculate(){this.rankings=[];for(let t=0;t<this.website_list.length;t++)this.rankings.push(.25);for(let e=0;e<this.iterations;e++){let i=[];for(let s=0;s<this.website_list.length;s++)i.push(this.calculate_rank(s));this.rankings=i}for(let n=0;n<this.website_list.length;n++)this.website_list[n].rank(this.rankings[n]);return this}}web=new Web;